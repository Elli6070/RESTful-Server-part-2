<!DOCTYPE html>
<html>
<head>
	<title>St. Paul Crime</title>

	<script src="https://unpkg.com/vue"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

</head>
<body>

<div id="app">
    <ul>
      <li>
	  </li>
	  <li>
		<div id="mapid" style="width: 600px; height: 400px;"></div>
	  </li>
	  <li>
		 <!--Insert grid here-->
	  </li>
    </ul>
  </div>

  <script>
    var app = new Vue({
      el: '#app',
      
	  data: {
		incidents: null,
      },
      methods: {
        humanizeURL: function (url) {
          return url
            .replace(/^https?:\/\//, '')
            .replace(/\/$/, '')
        }
      },
	  mounted (){
		axios.get("http://cisc-dean.stthomas.edu:8027/incidents?start_date=2019-10-01&end_date=2019-10-31")
		.then((response) => {
			console.log("Retrieved Data");
			this.incidents = response;
			populateMap(this.incidents["data"]);
		})
	  }
    })
	let visibleNeighborhoods = {
			1: true, 2: true, 3: true, 4: true, 5: true, 6: true, 7: true, 8: true, 9: true, 10: true, 11: true, 12: true, 13: true, 14: true, 15: true, 16: true, 17: true
		};
		
	let currentBounds = L.latLngBounds(L.latLng(44.989484, -93.209396), L.latLng(44.890331, -93.001686));
	//L.latLngBounds(L.latLng(mymap.getNorth(), mymap.getWest()), L.latLng(mymap.getSouth(), mymap.getEast()));
	function populateMap(incidents) {
		console.log("Populating map");
		console.log(currentBounds);
		var mymap = L.map('mapid').setView([44.955723, -93.106056], 13);
		var corner1 = L.latLng(44.989484, -93.209396);
		var corner2 = L.latLng(44.890331, -93.001686);
		var bounds = L.latLngBounds(corner1, corner2);
		
		L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
			attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
				'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
			id: 'mapbox/streets-v11',
			minZoom: 11,
			maxZoom: 18,
			maxBounds: bounds
		}).addTo(mymap);
		mymap.setMaxBounds(mymap.getBounds());

		var neighborhoodMap = {
			1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0
		};
		
		for (var key in incidents){
			if(incidents.hasOwnProperty(key)){
				neighborhoodMap[incidents[key].neighborhood_number]++;
			}
		}
		
		var Conway = L.marker([44.916959, -93.025327]).addTo(mymap);
		Conway.bindPopup("<b># Crimes: " + neighborhoodMap[1] + "</b><br>.").openPopup();
		
		var GES = L.marker([44.928323, -93.025327]).addTo(mymap);
		GES.bindPopup("<b># Crimes: " + neighborhoodMap[2] + "</b><br>.").openPopup();
		
		var WestSide = L.marker([44.930028, -93.080447]).addTo(mymap);
		WestSide.bindPopup("<b># Crimes: " + neighborhoodMap[3] + "</b><br>.").openPopup();
		
		var Dayton = L.marker([44.956010, -93.058301]).addTo(mymap);
		Dayton.bindPopup("<b># Crimes: " + neighborhoodMap[4] + "</b><br>.").openPopup();
		
		var Payne = L.marker([44.980341, -93.071940]).addTo(mymap);
		Payne.bindPopup("<b># Crimes: " + neighborhoodMap[5] + "</b><br>.").openPopup();
		
		var NorthEnd = L.marker([44.976798, -93.111655]).addTo(mymap);
		NorthEnd.bindPopup("<b># Crimes: " + neighborhoodMap[6] + "</b><br>.").openPopup();
		
		var ThomasDale = L.marker([44.963089, -93.147793]).addTo(mymap);
		ThomasDale.bindPopup("<b># Crimes: " + neighborhoodMap[7] + "</b><br>.").openPopup();
		
		var Summit = L.marker([44.948611, -93.126360]).addTo(mymap);
		Summit.bindPopup("<b># Crimes: " + neighborhoodMap[8] + "</b><br>.").openPopup();
		
		var WestSeventh = L.marker([44.932707, -93.119739]).addTo(mymap);
		WestSeventh.bindPopup("<b># Crimes: " + neighborhoodMap[9] + "</b><br>.").openPopup();
		
		var Como = L.marker([44.981661, -93.148235]).addTo(mymap);
		Como.bindPopup("<b># Crimes: " + neighborhoodMap[10] + "</b><br>.").openPopup();
		
		var Hamline = L.marker([44.961778, -93.167119]).addTo(mymap);
		Hamline.bindPopup("<b># Crimes: " + neighborhoodMap[11] + "</b><br>.").openPopup();
		
		var StAnthony = L.marker([44.973546, -93.197621]).addTo(mymap);
		StAnthony.bindPopup("<b># Crimes: " + neighborhoodMap[12] + "</b><br>.").openPopup();
		
		var UnionPark = L.marker([44.949164, -93.174827]).addTo(mymap);
		UnionPark.bindPopup("<b># Crimes: " + neighborhoodMap[13] + "</b><br>.").openPopup();
		
		var Macalaster = L.marker([44.934240, -93.174333]).addTo(mymap);
		Macalaster.bindPopup("<b># Crimes: " + neighborhoodMap[14] + "</b><br>.").openPopup();
		
		var Highland = L.marker([44.910549, -93.177474]).addTo(mymap);
		Highland.bindPopup("<b># Crimes: " + neighborhoodMap[15] + "</b><br>.").openPopup();
		
		var SummitHill = L.marker([44.939011, -93.138885]).addTo(mymap);
		SummitHill.bindPopup("<b># Crimes: " + neighborhoodMap[16] + "</b><br>.").openPopup();
		
		var CapitolRiver = L.marker([44.947381, -93.091022]).addTo(mymap);
		CapitolRiver.bindPopup("<b># Crimes: " + neighborhoodMap[17] + "</b><br>.").openPopup();
	}
	
	function getVisibleNeighborhoods(){
		
	}
  </script>

</body>
</html>